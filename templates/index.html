<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ndivhuwo & Mpho - Wedding Reservation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Great+Vibes&display=swap"
        rel="stylesheet">
</head>

<body>

    <div class="container">
        <header>
            <h1 class="font-holiday">Ndivhuwo & Mpho</h1>
            <p>We invite you to celebrate our special day with us.</p>
        </header>



        <!-- Wedding Details & Rsvp Sections -->
        <div class="details-section">

            <!-- Column 1: Wedding Details -->
            <div class="details-column">
                <h2 class="section-title">Wedding Details</h2>

                <p class="details-text"><strong>Date:</strong> 2nd May 2026 @ 10:00 AM</p>
                <p class="details-text venue"><strong>Venue:</strong> 22 Denne Rd., Rand Collieries, Brakpan</p>

                <!-- Google Map with Theme Styling -->
                <div class="map-container">
                    <iframe width="100%" height="100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
                        src="https://maps.google.com/maps?q=22%20Denne%20Rd%2C%20Rand%20Collieries%2C%20Brakpan&t=&z=15&ie=UTF8&iwloc=&output=embed"
                        class="map-frame"></iframe>
                </div>

                <p class="details-text"><strong>Theme:</strong> Beige & White</p>

                <div class="quote-box">
                    "Where you go I will go, and where you stay I will stay." <br>
                    <span class="quote-source">â€” Ruth 1:16 NIV</span>
                </div>
            </div>

            <!-- Column 2: Rsvp -->
            <div class="details-column">
                <div class="rsvp-card">
                    <h3 class="rsvp-title">Rsvp</h3>
                    <p class="rsvp-subtitle">Please confirm by 12th March 2026</p>
                    <hr class="rsvp-divider">
                    <p class="contact-info">Irene Sathege: <strong>+27 73 146 8192</strong></p>
                    <p class="contact-info">Kete Sadiki: <strong>+27 72 239 9527</strong></p>
                    <p class="contact-info">Beauty Rasetilo: <strong>+27 73 805 3169</strong></p>
                    <p class="no-children-notice">
                        * NO CHILDREN ALLOWED</p>
                </div>
            </div>
        </div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-box" style="background-color: var(--available-color);"></div>
                <span>Available</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background-color: var(--reserved-color);"></div>
                <span>Reserved</span>
            </div>
        </div>

        <div class="seat-grid">
            {% for i in range(1, total_seats + 1) %}
            <div class="seat {% if i in reserved_seats %}reserved{% else %}available{% endif %}" id="seat-{{ i }}" {% if
                i not in reserved_seats %}onclick="openReservationModal({{ i }})" {% endif %}
                title="{% if i in reserved_seats %}Reserved{% else %}Seat {{ i }}{% endif %}">
                {{ i }}
            </div>
            {% endfor %}
        </div>

        <button id="reserveBtn" class="btn">Reserve a Seat</button>
    </div>

    <!-- Reservation Modal -->
    <div id="reservationModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Reserve Your Seat</h2>
            <p>Please enter your details below. The system will assign you the best available seat.</p>
            <form id="reservationForm">
                <input type="hidden" id="seat_number" name="seat_number">
                <label for="first_name">First Name</label>
                <input type="text" id="first_name" name="first_name" required>

                <label for="surname">Surname</label>
                <input type="text" id="surname" name="surname" required>

                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" name="phone" required>

                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" required>

                <label for="dietary_restrictions">Dietary Restrictions (Optional)</label>
                <input type="text" id="dietary_restrictions" name="dietary_restrictions">

                <button type="submit" class="btn" style="width: 100%; margin-top: 1rem;">Submit Reservation</button>
            </form>
        </div>
    </div>

    <!-- Notification Modal -->
    <div id="notificationModal" class="modal">
        <div class="modal-content" style="text-align: center; padding: 3rem;">
            <h2 id="notifTitle" class="font-holiday" style="color: var(--accent-color); margin-bottom: 1rem;">Success
            </h2>
            <p id="notifMessage" style="font-size: 1.2rem; margin-bottom: 2rem;">Message goes here.</p>
            <button class="btn" onclick="closeNotification()">OK</button>
        </div>
    </div>

    <script>
        // Modal Logic
        const modal = document.getElementById("reservationModal");
        const btn = document.getElementById("reserveBtn");
        const span = document.getElementsByClassName("close")[0];
        const seatInput = document.getElementById("seat_number");
        const modalTitle = document.querySelector("#reservationModal h2");

        function openReservationModal(seatNum = null) {
            modal.style.display = "flex";
            if (seatNum) {
                seatInput.value = seatNum;
                modalTitle.innerText = "Reserve Seat #" + seatNum;
            } else {
                seatInput.value = "";
                modalTitle.innerText = "Reserve a Random Seat";
            }
        }

        btn.onclick = function () {
            openReservationModal(null);
        }

        span.onclick = function () {
            modal.style.display = "none";
        }

        const notifModal = document.getElementById("notificationModal");

        function showNotification(title, message, isSuccess) {
            document.getElementById("notifTitle").innerText = title;
            document.getElementById("notifTitle").style.color = isSuccess ? "var(--accent-color)" : "#c0392b";
            document.getElementById("notifMessage").innerText = message;
            notifModal.style.display = "flex";
        }

        function closeNotification() {
            notifModal.style.display = "none";
            if (document.getElementById("notifTitle").innerText.includes("Reservation submitted")) {
                location.reload();
            }
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Form Submission
        const form = document.getElementById('reservationForm');
        form.onsubmit = async function (e) {
            e.preventDefault();

            // Disable button to prevent double-booking
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerText = "Submitting...";

            const formData = new FormData(form);

            try {
                const response = await fetch('/reserve', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    modal.style.display = "none";
                    showNotification('Thank You!', result.message, true);
                } else {
                    showNotification('Attention', result.message, false);
                    submitBtn.disabled = false;
                    submitBtn.innerText = "Submit Reservation";
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error', 'An error occurred while submitting.', false);
                submitBtn.disabled = false;
                submitBtn.innerText = "Submit Reservation";
            }
        }


    </script>
</body>

</html>